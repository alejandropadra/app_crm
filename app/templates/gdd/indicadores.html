{% extends 'layout.html' %}
{% from 'helpers/_forms.html' import render_field %}

{% block body %}
{% block estilos %}
<link rel="stylesheet" href="{{ url_for('static', filename = 'css/estilos_tabla.css') }}">
<link href="https://cdn.jsdelivr.net/npm/flowbite@3.1.2/dist/flowbite.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/driver.js@latest/dist/driver.css"/>
<style>
    
</style>
{% endblock%}


<meta name="csrf-token" content="{{ csrf_token() }}">

<input type="hidden" value="{{usuario.habilitacion_gdd}}" name="" id="estatusProceso">
<input type="hidden" value=" {{usuario.ficha}}" id="ficha_usuario">
<input type="hidden" value=" {{año_fiscal}}" id="año_fiscal">







    <div class="bg-white p-5 rounded-[20px]  sombra " id="tarjetaprincipalgdi" >
    
        <div class="rounded-t mb-0 px-4 py-3 border-0 flex flex-col sm:flex-row justify-between items-center gap-3">
            <!-- Contenedor del título con flex-grow para ocupar el espacio a la izquierda -->
            <div class="relative px-0 md:px-4 flex-grow flex gap-5">
                <h3 class="text-left opado">Carga de Indicadores Funcionales</h3>
                <!--<button id="autoayuda" type="button" class=" opado absolute md:static top-[-30px] right-[-35px] autoayuda bg-slate-600 flex justify-center  w-8 h-8 rounded-[50%] items-center text-white hover:bg-slate-400 p-4  outline-none focus:outline-none ease-linear transition-all duration-150" type="button">
                    <span class="">
                        <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="#fff" stroke-width="2.5" viewBox="0 0 256 256"><path d="M192,96c0,28.51-24.47,52.11-56,55.56V160a8,8,0,0,1-16,0V144a8,8,0,0,1,8-8c26.47,0,48-17.94,48-40s-21.53-40-48-40S80,73.94,80,96a8,8,0,0,1-16,0c0-30.88,28.71-56,64-56S192,65.12,192,96Zm-64,96a16,16,0,1,0,16,16A16,16,0,0,0,128,192Z"></path></svg>
                </button>-->
            </div>
        
            <!-- Contenedor de botones, alineados a la derecha -->
            <div class="flex space-x-2 items-center">
                {%if usuario.habilitacion_gdd != 'Abierto'%}

                <button data-tooltip-target="tooltip-agregar" type="button" disabled   id="openModal" class=" opado  text-zinc-200 flex gap-2 items-center bg-gray-400 px-4 py-2 rounded-lg font-medium text-sm transition-all ease-in duration-200 cursor-none">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="size-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v6m3-3H9m12 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                    </svg>

                    <p class="text-white">Agregar</p>
                </button>

                <div id="tooltip-agregar" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 text-sm font-medium text-white transition-opacity duration-300 bg-gray-900 rounded-lg shadow-xs opacity-0 tooltip dark:bg-gray-700" >
                    El boton esta deshabilitado
                    <div class="tooltip-arrow" data-popper-arrow></div>
                </div>

                {%else%}

                <button id="openModal" class=" opado cursor-pointer text-zinc-200 flex gap-2 items-center bg-valor-azul px-4 py-2 rounded-lg font-medium text-sm hover:bg-azul-dark transition-all ease-in duration-200" type="button">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="size-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v6m3-3H9m12 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                    </svg>

                    <p class="text-white">Agregar</p>
                </button>

                {%endif%}



                {%if usuario.habilitacion_gdd != 'Abierto'%}
                <button onclick="deleteSelectedRows()" data-tooltip-target="tooltip-borrar"  id="btnBorrar" class=" opado  text-zinc-200 flex gap-2 items-center bg-red-300 cursor-none px-4 py-2 rounded-lg font-medium text-sm hover:bg-azul-dark transition-all ease-in duration-200" type="button" disabled>
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="size-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />
                    </svg>

                    <p class="text-white">Borrar</p>
                </button>

                <div id="tooltip-borrar" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 text-sm font-medium text-white transition-opacity duration-300 bg-gray-900 rounded-lg shadow-xs opacity-0 tooltip dark:bg-gray-700" >
                    El boton esta deshabilitado
                    <div class="tooltip-arrow" data-popper-arrow></div>
                </div>

                {%else%}

                <button onclick="deleteSelectedRows()" id="btnBorrar" class=" opado cursor-pointer text-zinc-200 flex gap-2 items-center bg-rojo-crm px-4 py-2 rounded-lg font-medium text-sm hover:bg-azul-dark transition-all ease-in duration-200" type="button">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="size-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />
                    </svg>

                    <p class="text-white">Borrar</p>
                </button>

                {%endif%}






                
                
            </div>
        </div>

        <div class="opado relative overflow-x-auto border border-gray-200 dark:border-gray-700 md:rounded-xl" id="contenedor-table">
            <table class="w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400 divide-y divide-gray-200" id="indicadorTable">
                <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
                    <tr>
                        <th scope="col" class="p-4">
                            <div class="flex items-center">
                                <input id="checkbox-all-search" type="checkbox" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded-sm focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 dark:focus:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
                                <label for="checkbox-all-search" class="sr-only">checkbox</label>
                            </div>
                        </th>
                        <th scope="col" class="px-6 py-3 min-w-[300px] max-w-[280px] break-words whitespace-normal " id="indicadorAyuda">
                            Indicadores
                        </th>
                        <th scope="col" class="px-6 py-3 min-w-[70px] max-w-[280px] text-center" id="tendenciaIndicador">
                            Tendencia
                        </th>
                        <th scope="col" class="px-6 py-3 min-w-[100px] max-w-[280px] text-center" id="pesoIndicador">
                            Peso
                        </th>
                        <th scope="col" class="px-6 py-3  min-w-[120px] max-w-[280px] text-center" id="realafIndicador">
                            Real AF25
                        </th>
                        <th scope="col" class="px-6 py-3 min-w-[160px] max-w-[280px] text-center" id="objetivoAFIndicador">
                            PPTO U OBJETIVO AF26
                        </th>
                        <th scope="col" class="px-6 py-3 min-w-[160px] max-w-[280px] text-center" id="REAlAFAyuda">
                            REAL AF26
                        </th>
                        <th scope="col" class="px-6 py-3 min-w-[100px] max-w-[280px] text-center" id="cumplimientoIndicador">
                            Cumplimiento
                        </th>
                        <th scope="col" class="px-6 py-3 min-w-[100px] max-w-[280px] text-center" id="desempeñoIndicador">
                            Desempeño
                        </th>
                        <th scope="col" class="px-6 py-3 min-w-[120px] max-w-[280px] text-center" id="estatusIndicador">
                            Estatus
                        </th>
                        <th scope="col" class="px-6 py-3 min-w-[120px] max-w-[280px] text-center" id="archivosAyuda">
                            Archivos
                        </th>
                        <th scope="col" class="px-6 py-3 min-w-[100px] max-w-[280px] text-center" id="editarAyuda">
                            Editar
                        </th>
                        <th class="hidden"></th>
                    </tr>
                </thead>

                <tbody>
                    {% for indicador in indicadores %}
                    <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 border-gray-200 hover:bg-gray-50 dark:hover:bg-gray-600">
                        <td class="w-4 p-4">
                            <div class="flex items-center">
                                <input id="checkbox-table-search-1" type="checkbox" class="row-checkbox w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded-sm focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 dark:focus:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
                                <label for="checkbox-table-search-1" class="sr-only">checkbox</label>
                            </div>
                        </td>
        
                        <td class="px-4 py-3 text-sm text-gray-700  text-left break-words whitespace-normal align-center">
                            {{indicador.nombre_indicador}}
                        </td>
        
                        <td class="px-6 py-4 text-sm text-gray-700 text-center">
                            {{indicador.tendencia}}
                        </td>
        
                        <td class="px-6 py-4 text-sm text-gray-700 text-center font-bold">
                            {{indicador.peso|int}}%
                        </td>
        
                        <td class="px-6 py-4 text-sm text-gray-700 text-center">
                            {% if indicador.real_af_antes%} {{indicador.real_af_antes}} {%else%} N/A {%endif%}
                        </td>
        
                        <td class="px-6 py-4 text-sm text-gray-700 text-center">
                            {% if indicador.objetivo_af_actual%} {{indicador.objetivo_af_actual}} {%else%} N/A {%endif%}
                        </td>
                        <td class="px-6 py-4 text-sm text-gray-700 text-center">
                            {% if indicador.real_af_actual%} {{indicador.real_af_actual}} {%elif indicador.real_af_actual == 0%} 0{%else%} N/A {%endif%}
                        </td>
                        <td class="px-6 py-4 text-gray-700 font-extrabold text-center">
        
                        {% if indicador.cumplimiento%} {{indicador.cumplimiento}}% {%else%} 0% {%endif%}
                        </td>
        
                        <td class=" px-6 py-4  text-center font-bold text-[#333]">
                            <span class="{% if indicador.desempeno == 'O'%} bg-blue-300  
                                            {% elif indicador.desempeno == 'UP'%} bg-red-300 
                                            {% elif indicador.desempeno == 'FP-'%} bg-yellow-300 
                                            {% elif indicador.desempeno == 'FP'%} bg-green-300 
                                            {% elif indicador.desempeno == 'FP+'%} bg-green-300 
                                            {% else %} bg-slate-300 text-slate-600 {%endif%}
                                            font-bold
                                            p-3 rounded-2xl">{% if indicador.desempeno%} {{indicador.desempeno}} {%else%} NN {%endif%}</span>
                        </td>
        
                        <td class=" px-6 py-4  text-center">
                            {% if indicador.status_aprobacion%}
                            <span class=" p-3 rounded-xl text-center {% if indicador.status_aprobacion == 'A'%} bg-green-300  
                                        {% elif indicador.status_aprobacion == 'R'%} bg-red-300 
                                        {% elif indicador.status_aprobacion == 'C'%} bg-blue-300 
                                        {%endif%} font-bold  text-[#333]" >{{indicador.status_aprobacion}}</span> 
                            {%else%}
                            <span class=" bg-slate-300 text-slate-600 font-bold
                                            p-3 rounded-2xl"> NN</span>
                            {%endif%}
                        </td>
        
                        <td class="p-2">
                            <div class="flex flex-col gap-5">
                                <div class="w-full">
                                    <!-- Botón con tooltip -->
                                    <a data-tooltip-target="tooltip-default{{loop.index0}}"  href="{{ url_for('.hoja_vida', indicador=indicador.id) }}" class="p-2 w-full bg-azul-dark text-white rounded-xl" id="hojavida" >
                                        Hoja de Vida
                                    </a>

                                    <div id="tooltip-default{{loop.index0}}" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 text-sm font-medium text-white transition-opacity duration-300 bg-gray-900 rounded-lg shadow-xs opacity-0 tooltip dark:bg-gray-700" >
                                        Ver hoja de Vida

                        
                                        <div class="tooltip-arrow" data-popper-arrow></div>
                                    </div>
                                    
                                </div>
        
                                <div class="w-full">
                                    <!-- Botón con tooltip -->
                                    <a data-tooltip-target="tooltip-default-cr{{loop.index0}}"  href="{{ url_for('.cronograma', indicador=indicador.id) }}"   class="p-2 w-full bg-azul-dark text-white rounded-xl" id="cronograma">
                                        Cronograma
                                    </a>
                                    
                                    <div id="tooltip-default-cr{{loop.index0}}" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 text-sm font-medium text-white transition-opacity duration-300 bg-gray-900 rounded-lg shadow-xs opacity-0 tooltip dark:bg-gray-700">
                                        Ver Cronograma
                                        <div class="tooltip-arrow" data-popper-arrow></div>
                                    </div>
                                    
                                </div>
                                
                            </div>
                        </td>
        
                        <td class=" px-3">

                            {%if usuario.habilitacion_gdd =='AFACTIVO' or  indicador.status == 'Abierto' %}
                                <button class="p-2 w-full  bg-green-600 text-white rounded-xl flex flex-col items-center justify-center" id="editar"onclick="editRow(this)"  >Editar <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-lock-keyhole-open-icon lucide-lock-keyhole-open text-white"><circle cx="12" cy="16" r="1"/><rect width="18" height="12" x="3" y="10" rx="2"/><path d="M7 10V7a5 5 0 0 1 9.33-2.5"/></svg></button>
                            {%elif indicador.status == 'Cerrado' or indicador.status_aprobacion == 'A' or usuario.habilitacion_gdd =='Cerrado'%}
                            <button class="p-2 w-full bg-rojo-crm text-white rounded-xl flex flex-col items-center justify-center" id="editar"onclick="editRow(this)"  disabled>Bloqueado <svg  xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-lock-keyhole-icon lucide-lock-keyhole text-white"><circle cx="12" cy="16" r="1"/><rect x="3" y="10" width="18" height="12" rx="2"/><path d="M7 10V7a5 5 0 0 1 10 0v3"/></svg></button>
                            {%endif%}
                        </td>
                        <td class=" hidden">"
                            {{indicador.id}}
                        </td>

                        
        
                    </tr>

                    {%endfor%}
                    
                </tbody>
                <tfoot>
                    <tr>
                        <th scope="row"></th>
                        <td></td>
                        <td></td>
                        <td class="pr-4 align-middle border text-xs whitespace-nowrap p-4 text-center font-bold bg-blue-200 text-[#333]" id="footerPeso">  {{ total_peso }}%</td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td class="pr-4 align-middle border text-xs whitespace-nowrap p-4 text-center font-extrabold text-gray-700
                        
                                {% if total_cumplimiento < 50%}
                                    bg-blue-200 
                                {% elif total_cumplimiento >= 50%}
                                    bg-green-300 
                            {%endif%}" id="footerCumplimiento">{{total_cumplimiento}}%
                        </td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>








<!-- Contenedor del modal -->
<div id="modal-container">
    <div class="modal-background" >
        <div class="modal max-h-[90vh] w-[90%] max-w-2xl flex flex-col"  >
            <!-- Header with close button (fixed at top) -->
            <div class="flex items-center justify-between p-4 border-b border-gray-300 bg-white sticky bottom-0">
                <div class=" flex items-center gap-3">
                    <h3>Registro de Indicador</h3>

                </div>
                


                <button onclick="cerrarModal('x')" class=" cursor-pointer text-zinc-200 flex gap-2 items-center bg-rojo-crm px-2 py-2 rounded-[100%] font-medium text-sm hover:bg-red-300 transition-all ease-in duration-200" type="button">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>


            
            <!-- Scrollable content area -->
            <div class="overflow-y-auto flex-grow p-4" id="content">
                <form class="mt-2" id="indicatorForm">
                    <div class="flex flex-col">
                        <div class="form-group flex flex-col gap-3 mb-4 p-4">
                            <div class="flex flex-col gap-1">
                                <label class="text-xs font-semibold text-gray-500 text-left" for="Indicador">Nombre del Indicador</label>
                                <textarea id="Indicador" name="Indicador" placeholder="Ejemplo: Indicador 1" required="" rows="4" cols="50" class="w-full px-4 rounded-lg bg-gray-200 border border-transparent focus:border-gray-900 focus:bg-white focus:outline-none transition-all"> </textarea>
                            </div>

                            <div class="flex flex-col gap-1">
                                <label class="text-xs font-semibold text-gray-500 text-left" for="peso">Peso (%)</label>
                                <input type="number" id="peso" name="peso" max="100" required="" class="w-full px-4 rounded-lg bg-gray-200 border border-transparent focus:border-gray-900 focus:bg-white focus:outline-none transition-all h-10" placeholder="Ejemplo: 30">
                            </div>

                            <div class="flex flex-col gap-1">
                                <label class="text-xs font-semibold text-gray-500 text-left" for="Indicador">Tendencia</label>
                                <select id="Tendencia" name="Tendencia" required="" class="w-full px-4 rounded-lg bg-gray-200 border border-transparent focus:border-gray-900 focus:bg-white focus:outline-none transition-all h-10">
                                    <option value="A">A</option>
                                    <option value="D" selected>D</option>
                                </select>
                            </div>

                            <div class="flex flex-col gap-1">
                                <label class="text-xs font-semibold text-gray-500 text-left" for="AFANTERIOR">REAL AF25</label>
                                <input type="number" id="AFANTERIOR" name="AFANTERIOR" required="" class="w-full px-4 rounded-lg bg-gray-200 border border-transparent focus:border-gray-900 focus:bg-white focus:outline-none transition-all h-100" placeholder="Ejemplo: 200">
                            </div>

                            <div class="flex flex-col gap-1">
                                <label for="AFPPTO" class="text-xs font-semibold text-gray-500 text-left">PPTO U OBJETIVO AF26</label>
                                <input type="number" id="AFPPTO" name="AFPPTO" required="" class="w-full px-4 rounded-lg bg-gray-200 border border-transparent focus:border-gray-900 focus:bg-white focus:outline-none transition-all h-100" placeholder="Ejemplo: 100">
                            </div>

                            
                            <div class="flex flex-col gap-1">
                                <label for="AFACTUAL" class="text-xs font-semibold text-gray-500 text-left">REAL AF26</label>
                                <input type="number" id="AFACTUAL" name="AFACTUAL" class="w-full px-4 rounded-lg bg-gray-200 border border-transparent focus:border-gray-900 focus:bg-white focus:outline-none transition-all h-100" placeholder="{%if estatus_proceso =='Abriendo'%} Campo a completar al cierre del ejercicio {%else%} Ejemplo: 300 {%endif%}">
                            </div>

                        </div>
                    </div>
                </form>
            </div>
            

            <div class="flex  justify-between space-x-2 p-4 border-t border-gray-300 bg-white sticky bottom-0">
                <button id="autoayudaModal" class="absolute md:static top-[-30px] right-[-35px] autoayuda bg-slate-600 flex justify-center  w-8 h-8 rounded-[50%] items-center text-white hover:bg-slate-400 p-4  outline-none focus:outline-none ease-linear transition-all duration-150" type="button">
                    <span class="">
                        <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="#fff" stroke-width="2.5" viewBox="0 0 256 256"><path d="M192,96c0,28.51-24.47,52.11-56,55.56V160a8,8,0,0,1-16,0V144a8,8,0,0,1,8-8c26.47,0,48-17.94,48-40s-21.53-40-48-40S80,73.94,80,96a8,8,0,0,1-16,0c0-30.88,28.71-56,64-56S192,65.12,192,96Zm-64,96a16,16,0,1,0,16,16A16,16,0,0,0,128,192Z"></path></svg>
                </button>
                <button id="botonModal" type="button" class="px-4 py-2 bg-blue-900 text-white rounded hover:bg-slate-400">
                    Guardar
                </button>
                
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block js%}
<script>
    const imagenLogoCorimon = "{{ url_for('static', filename='img/Corimon_logo.png') }}";
</script>
<script src="{{ url_for('static', filename='js/GDD.js') }}"></script>
{% endblock %}